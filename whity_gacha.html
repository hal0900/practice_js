<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>ホワイティ帝国10連ガチャ</title>
        <style>
            h1 {
                text-align: center;
            }
            body {
                font-size: 16px; /* または 16px 程度 */
                line-height: 1.6;
                text-align: center;
            }
            @keyframes sparkle {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.5; }
            }

            .sparkle-banner {
                font-weight: bold;
                color: orangered;
                font-size: large;
                animation: sparkle 1s infinite;
            }

            .result-area {
                margin-top: 1em;
                font-family: sans-serif;
            }
            .rare {
                color: royalblue;
                font-weight: bold;
            }
            .super-rare {
                color: darkorange;
                font-weight: bold;
                text-decoration: underline;
            }
            .super-super-rare {
                color: goldenrod;
                font-weight: bold;
                text-decoration: underline;
            }
            .ultra-rare {
                color: red;
                font-size: large;
                font-weight: bold;
                text-decoration: underline;
            }
            .normal {
                color: black;
            }
            #gachaButton {
                padding: 1em 2em;        /* 上下・左右の余白 */
                font-size: 1.5rem;       /* 文字サイズ */
                font-weight: bold;       /* 太字 */
                border-radius: 8px;      /* 角丸 */
                background-color: #4CAF50; /* 背景色（緑系） */
                color: white;            /* 文字色 */
                border: none;            /* 枠線なし */
                cursor: pointer;         /* ポインター表示 */
                transition: background-color 0.3s ease;
            }
            #gachaButton:hover {
                background-color: #45a049; /* ホバー時の色 */
            }
            .button-wrapper {
                margin: 1em;
            }
        </style>
    </head>
    <body>

        <h1>ホワイティ帝国10連ガチャ</h1>

        <div class="button-wrapper">
            <button type="button" id="gachaButton" onclick="runGacha()">ガチャをまわす！</button>
        </div>

        <div id="results" class="result-area"></div>

        <script>
            // ガシャの要素一覧
            const gachaItems = [
                { name: "海苔", rarity: "normal", weight: 50 },
                { name: "君は彼方", rarity: "normal", weight: 50 },
                { name: "586さん", rarity: "rare", weight: 30} ,
                { name: "586さん〔Dクラス職員〕", rarity: "rare", weight: 30 },
                { name: "586さん（水着ver）", rarity: "super-rare", weight: 15 },
                { name: "ゴーストトリックやりなよ", rarity: "super-super-rare", weight: 5 },
                { name: "与謝野晶子", rarity: "ultra-rare", weight: 1 }
            ];

            // レアリティの略称を作成
            const rarityShortMap = {
                "normal": "N",
                "rare": "R",
                "super-rare": "SR",
                "super-super-rare": "SSR",
                "ultra-rare": "UR"
            };

            // 抽選用の累積テーブルを作る関数
            function buildWeightedTable(items) {
                let table = [];
                items.forEach(item => {
                    for (let i = 0; i < item.weight; i++) {
                        table.push(item);
                    }
                });
                return table
            }

            // 重み付きで1つ抽選
            function drawItem(weightedTable) {
                const index = Math.floor(Math.random() * weightedTable.length);
                return weightedTable[index];
            }

            // 10連ガチャを実行
            function runGacha() {
                const button = document.getElementById("gachaButton");
                button.disabled = true;

                const resultArea = document.getElementById("results");
                resultArea.innerHTML = ""; // 前回の結果を消す

                const table = buildWeightedTable(gachaItems);

                // 確定枠用：高レアだけのテーブルを作成
                const highRarityItems = gachaItems.filter(item =>
                    item.rarity === "super-rare" ||
                    item.rarity === "super-super-rare" ||
                    item.rarity === "ultra-rare"
                );
                const highRarityTable = buildWeightedTable(highRarityItems);

                const results = [];

                // 最初の9回：通常抽選
                for (let i = 0; i < 9; i++) {
                    results.push(drawItem(table));
                }

                // 最後の1回：高レア確定
                results.push(drawItem(highRarityTable));

                // 表示遅延を管理
                let currentDelay = 0;

                // 1行ずつ順に表示
                results.forEach((item, i) => {
                    const isHighRarity = item.rarity === "ultra-rare" || item.rarity === "super-super-rare";

                    setTimeout(() => {
                        // 高レアリティの出現の前に確定演出を挿入
                        if (isHighRarity) {
                            const sparkleBefore = document.createElement("p");
                            sparkleBefore.textContent = "✨✨✨ ！！！高レア登場！！！ ✨✨✨";
                            sparkleBefore.classList.add("sparkle-banner");
                            resultArea.appendChild(sparkleBefore);
                        }
                    }, currentDelay);

                    // 演出後の追加表示（高レアのみ追加で待つ）
                    const displayItemDelay = currentDelay + (isHighRarity ? 500 : 0);

                    setTimeout(() => {
                        const p = document.createElement("p");
                        const shortRarity = rarityShortMap[item.rarity] || "??";
                        if (item.rarity === "ultra-rare") {
                            p.textContent = `【${shortRarity}】✨✨${item.name}✨✨`;
                        } else {
                            p.textContent = `【${shortRarity}】${item.name}`;
                        }
                        //rarityに応じてスタイルを付与
                        p.classList.add(item.rarity);
                        //ガチャ結果を表示
                        resultArea.appendChild(p);

                        //ultra-rareの後にも✨✨✨✨✨✨を挿入
                        if (isHighRarity) {
                            const sparkleAfter = document.createElement("p");
                            sparkleAfter.textContent = "✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨";
                            sparkleAfter.classList.add("sparkle-banner");
                            resultArea.appendChild(sparkleAfter);
                        }
                    }, displayItemDelay);

                    // 次の表示までの時間を加算（通常表示300ms + 高レアはさらに500ms）
                    currentDelay = displayItemDelay + 300;
                });

                // 全ての表示が終わったあとにボタンを有効化
                setTimeout(() => {
                    button.disabled = false;
                }, currentDelay);
            }
        </script>

        <a href="index.html">戻る</a><br>

    </body>
</html>